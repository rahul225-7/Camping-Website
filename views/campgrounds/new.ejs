<% layout('layouts/boilerplate') %>

<div class="row justify-content-center">
  <div class="col-lg-8 col-md-10">

    <div class="card shadow-lg border-0">
      <div class="card-body p-4 p-md-5">

        <h2 class="text-center fw-bold mb-4">Create New Campground</h2>

        <form action="/campgrounds" method="POST" novalidate class="needs-validation">

          <!-- TITLE -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Title</label>
            <input
              class="form-control form-control-lg"
              type="text"
              name="campground[title]"
              placeholder="Beautiful Mountain Retreat"
              required
            >
            <div class="invalid-feedback">Title is required.</div>
          </div>

          <!-- LOCATION -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Location</label>
            <input
              class="form-control form-control-lg"
              type="text"
              name="campground[location]"
              placeholder="Yosemite, California"
              required
            >
            <div class="invalid-feedback">Location is required.</div>
          </div>

          <!-- IMAGE URL + RANDOM BUTTON -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Image URL</label>

            <div class="input-group">
              <input
                id="imageUrlInput"
                class="form-control"
                type="text"
                name="campground[image]"
                placeholder="https://images.pexels.com/..."
                required
              >
              <button
                type="button"
                id="randomImageBtn"
                class="btn btn-outline-secondary"
              >
                üé≤ Random
              </button>
            </div>

            <div class="form-text">
              Click ‚ÄúRandom‚Äù to auto-fill a camping image.
            </div>
          </div>

          <!-- PRICE -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Price per night</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input
                class="form-control"
                type="number"
                step="0.01"
                name="campground[price]"
                placeholder="25"
                required
              >
            </div>
          </div>

          <!-- DESCRIPTION -->
          <div class="mb-4">
            <label class="form-label fw-semibold">Description</label>
            <textarea
              class="form-control"
              rows="4"
              name="campground[description]"
              placeholder="Describe the campground..."
              required
            ></textarea>
          </div>

          <!-- ACTIONS -->
          <div class="d-grid gap-2">
            <button class="btn btn-success btn-lg">
              ‚ûï Add Campground
            </button>
            <a href="/campgrounds" class="btn btn-outline-secondary">
              ‚Üê Back to All Campgrounds
            </a>
          </div>

        </form>

      </div>
    </div>

  </div>
</div>

<!-- FRONTEND SCRIPT -->
<script>
  document.getElementById('randomImageBtn').addEventListener('click', async () => {
    const btn = document.getElementById('randomImageBtn');
    btn.disabled = true;
    btn.innerText = 'Loading‚Ä¶';

    try {
      const res = await fetch('/api/random-camp-image');
      const data = await res.json();
      document.getElementById('imageUrlInput').value = data.imageUrl;
    } catch (err) {
      alert('Failed to fetch image');
    } finally {
      btn.disabled = false;
      btn.innerText = 'üé≤ Random';
    }
  });
</script>
